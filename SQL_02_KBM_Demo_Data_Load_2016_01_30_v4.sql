/*
 * ========================================================================
 * Filename:    SQL_01_KBM_Demo_Data_Load
 * Description: This file helps with loading fixed width files into SQL
 *              Server database
 * Author:      Vishwa Kolla
 * Version(s):
 *  V1: 2016/01/30  Initial version
 *  V2: 2016/01/30  Updated with code
 *  V3: 2016/01/30  Complete code to load 10 rows for PII file.
 *  V4: 2016/01/30  Re-purposed code to load 10 rows for demo file.
 * ========================================================================
 */

USE INS_DS_MKTG;

/*
 * 01: Create a shell.
 *
 * This shell captures the entire string. Once the data is in the database
 * we can split the data into different tables as we see fit.
 */
DROP  TABLE   T_KBM_DEMO_STG;
CREATE TABLE  T_KBM_DEMO_STG (
  RAW_DAT varchar(max)
);

/*
 * 02: Bulk load data.
 */
BULK INSERT
  T_KBM_DEMO_STG
FROM
  'Z:\02 - KBM Decrypted Files\02 - Demos\1511_ID3963D_FILE06_Top';

DELETE FROM T_KBM_DEMO_STG;

BULK INSERT
  T_KBM_DEMO_STG
FROM
  'Z:\02 - KBM Decrypted Files\02 - Demos\1511_ID3963D_FILE01';

BULK INSERT
  T_KBM_DEMO_STG
FROM
  'Z:\02 - KBM Decrypted Files\02 - Demos\1511_ID3963D_FILE02';

BULK INSERT
  T_KBM_DEMO_STG
FROM
  'Z:\02 - KBM Decrypted Files\02 - Demos\1511_ID3963D_FILE03';

BULK INSERT
  T_KBM_DEMO_STG
FROM
  'Z:\02 - KBM Decrypted Files\02 - Demos\1511_ID3963D_FILE04';

BULK INSERT
  T_KBM_DEMO_STG
FROM
  'Z:\02 - KBM Decrypted Files\02 - Demos\1511_ID3963D_FILE05';

BULK INSERT
  T_KBM_DEMO_STG
FROM
  'Z:\02 - KBM Decrypted Files\02 - Demos\1511_ID3963D_FILE06';

/*
 * 03: QC.
 */
SELECT COUNT(1) FROM  T_KBM_DEMO_STG;
SELECT TOP 10 * FROM  T_KBM_DEMO_STG;

/*
 * 04: Create tables shell with extract.
 */
DROP TABLE T_KBM_DEMO;
CREATE TABLE T_KBM_DEMO (
  ZIP VARCHAR(5),
  P4 VARCHAR(4),
  CRRT VARCHAR(4),
  FPST VARCHAR(2),
  N2CTY VARCHAR(3),
  N2DMA VARCHAR(4),
  CBSA VARCHAR(5),
  N2NCY VARCHAR(1),
  LAT VARCHAR(9),
  LNG VARCHAR(9),
  N2BTN VARCHAR(4),
  N2TSC VARCHAR(2),
  N2TBG VARCHAR(1),
  N2BC VARCHAR(4),
  C210MYS VARCHAR(1),
  C210MAH VARCHAR(2),
  C210PWH VARCHAR(2),
  C210PHI VARCHAR(2),
  C210PBL VARCHAR(2),
  C210HMI VARCHAR(3),
  C210CIP VARCHAR(2),
  C210POO VARCHAR(2),
  C210HVA VARCHAR(3),
  C210PSU VARCHAR(2),
  C210MOB VARCHAR(2),
  C210BLU VARCHAR(2),
  C210WHT VARCHAR(2),
  C210PMR VARCHAR(2),
  C210PWC VARCHAR(2),
  C210AUTO VARCHAR(2),
  C210EBI VARCHAR(3),
  C210PDV VARCHAR(2),
  C210PMV VARCHAR(2),
  C210APVT VARCHAR(2),
  C210BPVT VARCHAR(2),
  C210M200 VARCHAR(2),
  C210B200 VARCHAR(2),
  C210KSES VARCHAR(3),
  C210PDSC VARCHAR(2),
  C210PDUC VARCHAR(2),
  N2ALV VARCHAR(1),
  OPA VARCHAR(1),
  VFLAG VARCHAR(2),
  PRDM VARCHAR(1),
  HHID VARCHAR(9),
  NONO2 VARCHAR(12),
  AGE_RANGE VARCHAR(1),
  ESTAGE VARCHAR(2),
  GEND VARCHAR(1),
  RACE VARCHAR(1),
  FAMP VARCHAR(1),
  POEP VARCHAR(1),
  ILOR VARCHAR(2),
  HOMSTAT VARCHAR(1),
  APT VARCHAR(1),
  ESTINC30 VARCHAR(1),
  NETW30 VARCHAR(1),
  ZINCDEC VARCHAR(1),
  ESTDII30 VARCHAR(1),
  MR VARCHAR(1),
  MOBPLUS VARCHAR(1),
  MARRIED VARCHAR(1),
  NAH19 VARCHAR(3),
  NPH19 VARCHAR(3),
  TINS VARCHAR(3),
  NOC19 VARCHAR(3),
  CA00 VARCHAR(1),
  CA03 VARCHAR(1),
  CA06 VARCHAR(1),
  CA11 VARCHAR(1),
  CA16 VARCHAR(1),
  POC19 VARCHAR(1),
  TUOC VARCHAR(4),
  TUOCS VARCHAR(4),
  SOHOIN VARCHAR(1),
  SOHOHH VARCHAR(1),
  ONLA VARCHAR(1),
  CPPD VARCHAR(6),
  DPVS VARCHAR(1),
  PUBH VARCHAR(1),
  SSON VARCHAR(1),
  VAC VARCHAR(1),
  EDUC VARCHAR(1),
  Z4HMVALU VARCHAR(4),
  CALAGE VARCHAR(2),
  CNBC VARCHAR(6),
  BC VARCHAR(1),
  RC VARCHAR(1),
  PRESCA VARCHAR(1),
  SRET VARCHAR(1),
  LOWD VARCHAR(1),
  MSR VARCHAR(1),
  HIR VARCHAR(1),
  TRVL VARCHAR(1),
  SPEC VARCHAR(1),
  SPEA VARCHAR(1),
  FINB VARCHAR(1),
  FINI VARCHAR(1),
  FINC VARCHAR(1),
  CSR VARCHAR(1),
  CE VARCHAR(1),
  FURN VARCHAR(1),
  HOMO VARCHAR(1),
  HOMI VARCHAR(1),
  MEMW VARCHAR(1),
  SPGD VARCHAR(1),
  TVMA VARCHAR(1),
  GROC VARCHAR(1),
  OILC VARCHAR(1),
  MISC VARCHAR(1),
  CACD VARCHAR(6),
  TRAD VARCHAR(1),
  CDB1 VARCHAR(6),
  CGN1 VARCHAR(1),
  CDB2 VARCHAR(6),
  CGN2 VARCHAR(1),
  CDB3 VARCHAR(6),
  CGN3 VARCHAR(1),
  CDB4 VARCHAR(6),
  CGN4 VARCHAR(1),
  CO VARCHAR(1),
  EMDM VARCHAR(1),
  PART VARCHAR(1),
  VOTE VARCHAR(1),
  CD VARCHAR(2),
  HTFH VARCHAR(1),
  BOAT VARCHAR(1),
  DNRINDX VARCHAR(1),
  DIANIMAL VARCHAR(1),
  DIARTS VARCHAR(1),
  DICHLD VARCHAR(1),
  DICNSRV VARCHAR(1),
  DIENV VARCHAR(1),
  DIHLTH VARCHAR(1),
  DIHUMN VARCHAR(1),
  DILIB VARCHAR(1),
  DIREL VARCHAR(1),
  DIVET VARCHAR(1),
  VETERAN VARCHAR(1),
  COLLEGE VARCHAR(1),
  AIRCRAFT VARCHAR(1),
  PILOTS VARCHAR(1),
  ATV VARCHAR(1),
  SNOW VARCHAR(1),
  CCW VARCHAR(1),
  HMVLADD VARCHAR(4),
  LNVLRTIO VARCHAR(4),
  ESTDIS30 VARCHAR(2),
  ESTDEB30 VARCHAR(1),
  ESTINV30 VARCHAR(1),
  HHCOMP VARCHAR(1),
  N65P VARCHAR(1),
  N6064 VARCHAR(1),
  N5059 VARCHAR(1),
  N4049 VARCHAR(1),
  N3039 VARCHAR(1),
  N2029 VARCHAR(1),
  N1819 VARCHAR(1),
  U18 VARCHAR(1),
  STLAPP VARCHAR(1),
  STLINDEX VARCHAR(1),
  BDOC VARCHAR(6),
  BANK VARCHAR(1),
  BNKI VARCHAR(1),
  PRESSURV VARCHAR(1),
  IOR VARCHAR(1),
  IHH VARCHAR(1),
  IIND VARCHAR(1),
  QHH VARCHAR(1),
  QIND VARCHAR(1),
);

INSERT T_KBM_DEMO
SELECT
  ZIP = SUBSTRING(RAW_DAT,1,5),
  P4 = SUBSTRING(RAW_DAT,6,4),
  CRRT = SUBSTRING(RAW_DAT,10,4),
  FPST = SUBSTRING(RAW_DAT,14,2),
  N2CTY = SUBSTRING(RAW_DAT,16,3),
  N2DMA = SUBSTRING(RAW_DAT,19,4),
  CBSA = SUBSTRING(RAW_DAT,23,5),
  N2NCY = SUBSTRING(RAW_DAT,28,1),
  LAT = SUBSTRING(RAW_DAT,29,9),
  LNG = SUBSTRING(RAW_DAT,38,9),
  N2BTN = SUBSTRING(RAW_DAT,47,4),
  N2TSC = SUBSTRING(RAW_DAT,51,2),
  N2TBG = SUBSTRING(RAW_DAT,53,1),
  N2BC = SUBSTRING(RAW_DAT,54,4),
  C210MYS = SUBSTRING(RAW_DAT,58,1),
  C210MAH = SUBSTRING(RAW_DAT,59,2),
  C210PWH = SUBSTRING(RAW_DAT,61,2),
  C210PHI = SUBSTRING(RAW_DAT,63,2),
  C210PBL = SUBSTRING(RAW_DAT,65,2),
  C210HMI = SUBSTRING(RAW_DAT,67,3),
  C210CIP = SUBSTRING(RAW_DAT,70,2),
  C210POO = SUBSTRING(RAW_DAT,72,2),
  C210HVA = SUBSTRING(RAW_DAT,74,3),
  C210PSU = SUBSTRING(RAW_DAT,77,2),
  C210MOB = SUBSTRING(RAW_DAT,79,2),
  C210BLU = SUBSTRING(RAW_DAT,81,2),
  C210WHT = SUBSTRING(RAW_DAT,83,2),
  C210PMR = SUBSTRING(RAW_DAT,85,2),
  C210PWC = SUBSTRING(RAW_DAT,87,2),
  C210AUTO = SUBSTRING(RAW_DAT,89,2),
  C210EBI = SUBSTRING(RAW_DAT,91,3),
  C210PDV = SUBSTRING(RAW_DAT,94,2),
  C210PMV = SUBSTRING(RAW_DAT,96,2),
  C210APVT = SUBSTRING(RAW_DAT,98,2),
  C210BPVT = SUBSTRING(RAW_DAT,100,2),
  C210M200 = SUBSTRING(RAW_DAT,102,2),
  C210B200 = SUBSTRING(RAW_DAT,104,2),
  C210KSES = SUBSTRING(RAW_DAT,106,3),
  C210PDSC = SUBSTRING(RAW_DAT,109,2),
  C210PDUC = SUBSTRING(RAW_DAT,111,2),
  N2ALV = SUBSTRING(RAW_DAT,113,1),
  OPA = SUBSTRING(RAW_DAT,114,1),
  VFLAG = SUBSTRING(RAW_DAT,115,2),
  PRDM = SUBSTRING(RAW_DAT,117,1),
  HHID = SUBSTRING(RAW_DAT,118,9),
  NONO2 = SUBSTRING(RAW_DAT,127,12),
  AGE_RANGE = SUBSTRING(RAW_DAT,139,1),
  ESTAGE = SUBSTRING(RAW_DAT,140,2),
  GEND = SUBSTRING(RAW_DAT,142,1),
  RACE = SUBSTRING(RAW_DAT,143,1),
  FAMP = SUBSTRING(RAW_DAT,144,1),
  POEP = SUBSTRING(RAW_DAT,145,1),
  ILOR = SUBSTRING(RAW_DAT,146,2),
  HOMSTAT = SUBSTRING(RAW_DAT,148,1),
  APT = SUBSTRING(RAW_DAT,149,1),
  ESTINC30 = SUBSTRING(RAW_DAT,150,1),
  NETW30 = SUBSTRING(RAW_DAT,151,1),
  ZINCDEC = SUBSTRING(RAW_DAT,152,1),
  ESTDII30 = SUBSTRING(RAW_DAT,153,1),
  MR = SUBSTRING(RAW_DAT,154,1),
  MOBPLUS = SUBSTRING(RAW_DAT,155,1),
  MARRIED = SUBSTRING(RAW_DAT,156,1),
  NAH19 = SUBSTRING(RAW_DAT,157,3),
  NPH19 = SUBSTRING(RAW_DAT,160,3),
  TINS = SUBSTRING(RAW_DAT,163,3),
  NOC19 = SUBSTRING(RAW_DAT,166,3),
  CA00 = SUBSTRING(RAW_DAT,169,1),
  CA03 = SUBSTRING(RAW_DAT,170,1),
  CA06 = SUBSTRING(RAW_DAT,171,1),
  CA11 = SUBSTRING(RAW_DAT,172,1),
  CA16 = SUBSTRING(RAW_DAT,173,1),
  POC19 = SUBSTRING(RAW_DAT,174,1),
  TUOC = SUBSTRING(RAW_DAT,175,4),
  TUOCS = SUBSTRING(RAW_DAT,179,4),
  SOHOIN = SUBSTRING(RAW_DAT,183,1),
  SOHOHH = SUBSTRING(RAW_DAT,184,1),
  ONLA = SUBSTRING(RAW_DAT,185,1),
  CPPD = SUBSTRING(RAW_DAT,186,6),
  DPVS = SUBSTRING(RAW_DAT,192,1),
  PUBH = SUBSTRING(RAW_DAT,193,1),
  SSON = SUBSTRING(RAW_DAT,194,1),
  VAC = SUBSTRING(RAW_DAT,195,1),
  EDUC = SUBSTRING(RAW_DAT,196,1),
  Z4HMVALU = SUBSTRING(RAW_DAT,197,4),
  CALAGE = SUBSTRING(RAW_DAT,201,2),
  CNBC = SUBSTRING(RAW_DAT,203,6),
  BC = SUBSTRING(RAW_DAT,209,1),
  RC = SUBSTRING(RAW_DAT,210,1),
  PRESCA = SUBSTRING(RAW_DAT,211,1),
  SRET = SUBSTRING(RAW_DAT,212,1),
  LOWD = SUBSTRING(RAW_DAT,213,1),
  MSR = SUBSTRING(RAW_DAT,214,1),
  HIR = SUBSTRING(RAW_DAT,215,1),
  TRVL = SUBSTRING(RAW_DAT,216,1),
  SPEC = SUBSTRING(RAW_DAT,217,1),
  SPEA = SUBSTRING(RAW_DAT,218,1),
  FINB = SUBSTRING(RAW_DAT,219,1),
  FINI = SUBSTRING(RAW_DAT,220,1),
  FINC = SUBSTRING(RAW_DAT,221,1),
  CSR = SUBSTRING(RAW_DAT,222,1),
  CE = SUBSTRING(RAW_DAT,223,1),
  FURN = SUBSTRING(RAW_DAT,224,1),
  HOMO = SUBSTRING(RAW_DAT,225,1),
  HOMI = SUBSTRING(RAW_DAT,226,1),
  MEMW = SUBSTRING(RAW_DAT,227,1),
  SPGD = SUBSTRING(RAW_DAT,228,1),
  TVMA = SUBSTRING(RAW_DAT,229,1),
  GROC = SUBSTRING(RAW_DAT,230,1),
  OILC = SUBSTRING(RAW_DAT,231,1),
  MISC = SUBSTRING(RAW_DAT,232,1),
  CACD = SUBSTRING(RAW_DAT,233,6),
  TRAD = SUBSTRING(RAW_DAT,239,1),
  CDB1 = SUBSTRING(RAW_DAT,240,6),
  CGN1 = SUBSTRING(RAW_DAT,246,1),
  CDB2 = SUBSTRING(RAW_DAT,247,6),
  CGN2 = SUBSTRING(RAW_DAT,253,1),
  CDB3 = SUBSTRING(RAW_DAT,254,6),
  CGN3 = SUBSTRING(RAW_DAT,260,1),
  CDB4 = SUBSTRING(RAW_DAT,261,6),
  CGN4 = SUBSTRING(RAW_DAT,267,1),
  CO = SUBSTRING(RAW_DAT,268,1),
  EMDM = SUBSTRING(RAW_DAT,269,1),
  PART = SUBSTRING(RAW_DAT,270,1),
  VOTE = SUBSTRING(RAW_DAT,271,1),
  CD = SUBSTRING(RAW_DAT,272,2),
  HTFH = SUBSTRING(RAW_DAT,274,1),
  BOAT = SUBSTRING(RAW_DAT,275,1),
  DNRINDX = SUBSTRING(RAW_DAT,276,1),
  DIANIMAL = SUBSTRING(RAW_DAT,277,1),
  DIARTS = SUBSTRING(RAW_DAT,278,1),
  DICHLD = SUBSTRING(RAW_DAT,279,1),
  DICNSRV = SUBSTRING(RAW_DAT,280,1),
  DIENV = SUBSTRING(RAW_DAT,281,1),
  DIHLTH = SUBSTRING(RAW_DAT,282,1),
  DIHUMN = SUBSTRING(RAW_DAT,283,1),
  DILIB = SUBSTRING(RAW_DAT,284,1),
  DIREL = SUBSTRING(RAW_DAT,285,1),
  DIVET = SUBSTRING(RAW_DAT,286,1),
  VETERAN = SUBSTRING(RAW_DAT,287,1),
  COLLEGE = SUBSTRING(RAW_DAT,288,1),
  AIRCRAFT = SUBSTRING(RAW_DAT,289,1),
  PILOTS = SUBSTRING(RAW_DAT,290,1),
  ATV = SUBSTRING(RAW_DAT,291,1),
  SNOW = SUBSTRING(RAW_DAT,292,1),
  CCW = SUBSTRING(RAW_DAT,293,1),
  HMVLADD = SUBSTRING(RAW_DAT,294,4),
  LNVLRTIO = SUBSTRING(RAW_DAT,298,4),
  ESTDIS30 = SUBSTRING(RAW_DAT,302,2),
  ESTDEB30 = SUBSTRING(RAW_DAT,304,1),
  ESTINV30 = SUBSTRING(RAW_DAT,305,1),
  HHCOMP = SUBSTRING(RAW_DAT,306,1),
  N65P = SUBSTRING(RAW_DAT,307,1),
  N6064 = SUBSTRING(RAW_DAT,308,1),
  N5059 = SUBSTRING(RAW_DAT,309,1),
  N4049 = SUBSTRING(RAW_DAT,310,1),
  N3039 = SUBSTRING(RAW_DAT,311,1),
  N2029 = SUBSTRING(RAW_DAT,312,1),
  N1819 = SUBSTRING(RAW_DAT,313,1),
  U18 = SUBSTRING(RAW_DAT,314,1),
  STLAPP = SUBSTRING(RAW_DAT,315,1),
  STLINDEX = SUBSTRING(RAW_DAT,316,1),
  BDOC = SUBSTRING(RAW_DAT,317,6),
  BANK = SUBSTRING(RAW_DAT,323,1),
  BNKI = SUBSTRING(RAW_DAT,324,1),
  PRESSURV = SUBSTRING(RAW_DAT,325,1),
  IOR = SUBSTRING(RAW_DAT,326,1),
  IHH = SUBSTRING(RAW_DAT,327,1),
  IIND = SUBSTRING(RAW_DAT,328,1),
  QHH = SUBSTRING(RAW_DAT,329,1),
  QIND = SUBSTRING(RAW_DAT,330,1)
FROM
  T_KBM_DEMO_STG
;

/*
 * 05: QC.
 */
SELECT COUNT(1) FROM  T_KBM_DEMO;
SELECT TOP 10 * FROM  T_KBM_DEMO;

/*
 * 06: Create index for faster data load
 */
CREATE INDEX T_KBM_DEMO_KLNK_IDX ON T_KBM_DEMO(KLNK);
